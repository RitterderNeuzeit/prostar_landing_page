
# ProStar Landing Page – Übersicht & Automatisierung

## Projekt-Flowchart (Ablauf)


```mermaid
flowchart TD
	A[Projektstart: pnpm run start:all] --> B[Dev-Server (pnpm dev)]
	A --> C[MySQL DB (Docker)]
	A --> D[Maildev (Docker, optional)]
	A --> E[E2E-Test (Playwright, Watch)]
	B --> F[API & Frontend erreichbar]
	C --> F
	D --> F
	E --> G[Automatisierte Kurszugangs-Prüfung]
	F --> G
	G --> H[Logs: tmp/dev-start.log]
```


**Ablauf:**

- Ein Befehl startet alles (Server, DB, Maildev, E2E-Test, Logging)
- E2E-Test prüft automatisch, ob Registrierung, E-Mail und Kurszugang funktionieren
- Alle Logs landen in `tmp/dev-start.log`

---



## Schnellstart (Alles-in-einem)

```sh
pnpm install
# Starte alles (Dev-Server, DB, Maildev, E2E-Test):
pnpm run start:all
# oder in VS Code: Task "Start Project (Full Automation)"
# Öffne http://localhost:3000
```


**Logs:** Siehe [`tmp/dev-start.log`](tmp/dev-start.log) für alle Prozesse.

**E2E-Test:** Läuft automatisch im Watch-Modus ([Playwright-Skript](e2e/course-access.spec.ts)).

**Maildev:** E-Mails werden an [http://localhost:1080](http://localhost:1080) zugestellt (Testumgebung).

---

## Kritische Abläufe & Gegenkontrollen


### Registrierung & Kurszugang (E2E-Flow)

1. Nutzer registriert sich auf `/course-access` → E-Mail wird versendet
2. Nutzer gibt Code ein → Verifizierung
3. Nach Erfolg: Weiterleitung zu `/course` (Kurszugriff)
4. E2E-Test prüft diesen Flow automatisch (siehe [e2e/course-access.spec.ts](e2e/course-access.spec.ts))
5. Gegenkontrolle: localStorage enthält `userEmail` & `userTier_*`

### Troubleshooting & Health-Check

- **Logs prüfen:** [`tmp/dev-start.log`](tmp/dev-start.log)
- **E2E-Test-Status:** Im Terminal/CI oder [e2e/course-access.spec.ts](e2e/course-access.spec.ts)
- **Maildev:** [http://localhost:1080](http://localhost:1080) (zeigt alle Test-E-Mails)
- **API erreichbar:** [http://localhost:3000/api/trpc/health.check](http://localhost:3000/api/trpc/health.check)

---

## Querverweise & Einstiegspunkte

- **Startskript:** [`scripts/start-all.sh`](scripts/start-all.sh) (startet alles, siehe Kommentare im Skript)
- **VS Code Task:** `.vscode/tasks.json` → "Start Project (Full Automation)"
- **E2E-Test:** [`e2e/course-access.spec.ts`](e2e/course-access.spec.ts) (vollständig kommentiert)
- **Maildev-Setup:** Im Startskript, siehe Kommentar
- **Automatisierte Checks:** [`docs/AUTOMATISIERTE_CHECKS.md`](docs/AUTOMATISIERTE_CHECKS.md)
- **Deployment/Automation:** [`docs/README_AUTOMATION.md`](docs/README_AUTOMATION.md)

---

## Erweiterung & Anpassung

- Neue Skripte/Automatisierungen einfach in `scripts/` ablegen und im Startskript ergänzen
- E2E-Tests können in `e2e/` beliebig erweitert werden (siehe Beispiel)
- Alle kritischen Flows sollten als E2E-Test abgedeckt sein

---


## FAQ für neue Entwickler

**Wie prüfe ich, ob alles läuft?**

- `pnpm run start:all` ausführen
- Browser öffnen: [http://localhost:3000](http://localhost:3000)
- E2E-Test-Status im Terminal prüfen
- Maildev öffnen: [http://localhost:1080](http://localhost:1080)
- Bei Fehlern: `tmp/dev-start.log` lesen

**Wo finde ich die wichtigsten Einstiegspunkte?**

- Start: [`scripts/start-all.sh`](scripts/start-all.sh)
- E2E-Test: [`e2e/course-access.spec.ts`](e2e/course-access.spec.ts)
- API: [`server/routers.ts`](server/routers.ts)
- E-Mail: [`server/services/emailService.ts`](server/services/emailService.ts)

**Wie kann ich neue Automatisierungen ergänzen?**

- Skript in `scripts/` ablegen
- Im Startskript (`scripts/start-all.sh`) ergänzen
- Im README verlinken

---

## Struktur

- `client/` – Frontend (Vite + React + Tailwind)
- `server/` – Backend (Express.js + tRPC + TypeScript)
- `drizzle/` – Datenbank (Drizzle ORM + MySQL)
- `shared/` – Gemeinsame Typen/Konstanten
- `docs/` – Dokumentation & Guides

## Wichtige Befehle

- `pnpm dev` – Dev-Server mit HMR
- `pnpm test` – Tests ausführen (Vitest)
- `pnpm run format:check` – Prettier-Check
- `pnpm run lint` – ESLint-Check
- `pnpm duplication:check` – Duplikate prüfen

## Automatisierte Checks

Siehe `docs/AUTOMATISIERTE_CHECKS.md` für Details zu Formatierung, Linting und Tests.

## Weitere Infos

- Stripe-Integration: `docs/STRIPE_INTEGRATION_GUIDE.md`
- Deployment: `docs/README_AUTOMATION.md`
- Fehlerbehebung: `docs/AUTOMATISIERTE_CHECKS.md`

---

**Stand:** 20.11.2025

## Automatisierte E2E-Tests & E-Mail-Flow

- End-to-End-Test: `npx tsx scripts/e2e-customer-flow.ts --email info.loco@gmx.de --name "Auto Tester"`
- CI: E2E-Job ist durch Secrets und Feature-Flag geschützt (`ALLOW_E2E_EMAILS`)
- Format- und Type-Checks: `pnpm run format:check`, `pnpm run check`
- Datenbank: MySQL-Container via Docker, Migrationen mit `pnpm run db:push`
- Dev-Server: `pnpm dev` (Port wird automatisch gewählt)
- Cleanup: `.history`-YAMLs entfernt, Format-Check läuft

Letzter Test: Zugangscode `infoloco_7262c310dfee4511bc61`, E-Mail versendet, Kurszugang erfolgreich.
